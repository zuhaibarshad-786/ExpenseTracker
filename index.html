<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elegant Expense Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-r from-blue-400 to-teal-300 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-4xl">
    <h1 class="text-2xl font-bold text-center text-gray-700 mb-4">Elegant Expense Tracker</h1>

    <form id="expense-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <input type="text" id="title" placeholder="Expense Title" required class="border p-2 rounded w-full" />
      <input type="number" id="amount" placeholder="Amount" required min="0" class="border p-2 rounded w-full" />
      <input type="text" id="category" placeholder="Category" required class="border p-2 rounded w-full" />
      <input type="date" id="date" required class="border p-2 rounded w-full" />
      <textarea id="notes" placeholder="Notes (optional)" class="border p-2 rounded w-full md:col-span-2"></textarea>
      <button type="submit" class="md:col-span-2 bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">Add Expense</button>
    </form>

    <h2 class="text-xl font-semibold text-gray-700 mb-2">Summary</h2>
    <div id="summary" class="bg-blue-50 p-4 rounded mb-4"></div>
    <canvas id="expenseChart" class="mb-6"></canvas>

    <h2 class="text-xl font-semibold text-gray-700 mb-2">All Expenses</h2>
    <div class="flex flex-col md:flex-row gap-4 mb-4">
      <input type="text" id="filter-category" placeholder="Filter by Category" class="border p-2 rounded w-full md:w-1/2" />
      <input type="date" id="filter-date" class="border p-2 rounded w-full md:w-1/2" />
    </div>
    <table class="table-auto w-full text-center border-collapse">
      <thead class="bg-blue-500 text-white">
        <tr>
          <th class="border p-2">Title</th>
          <th class="border p-2">Amount ($)</th>
          <th class="border p-2">Category</th>
          <th class="border p-2">Date</th>
          <th class="border p-2">Notes</th>
          <th class="border p-2">Actions</th>
        </tr>
      </thead>
      <tbody id="expense-table-body" class="bg-blue-50"></tbody>
    </table>
  </div>

  <script>
    let expenses = [];
    let chart;

    document.getElementById('expense-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const amount = parseFloat(document.getElementById('amount').value);
      if(amount < 0) return alert("Amount cannot be negative!");
      const exp = {
        id: Date.now(),
        title: document.getElementById('title').value,
        amount,
        category: document.getElementById('category').value,
        date: document.getElementById('date').value,
        notes: document.getElementById('notes').value
      };
      expenses.push(exp);
      saveExpenses();
      displayExpenses();
      displaySummary();
      this.reset();
    });

    document.getElementById('filter-category').addEventListener('input', displayExpenses);
    document.getElementById('filter-date').addEventListener('input', displayExpenses);

    function saveExpenses() {
      localStorage.setItem('expenses', JSON.stringify(expenses));
    }

    function loadExpenses() {
      const stored = localStorage.getItem('expenses');
      if(stored) expenses = JSON.parse(stored);
    }

    function displayExpenses() {
      const tbody = document.getElementById('expense-table-body');
      tbody.innerHTML = '';
      let filtered = [...expenses];
      const catFilter = document.getElementById('filter-category').value.toLowerCase();
      const dateFilter = document.getElementById('filter-date').value;

      if(catFilter) filtered = filtered.filter(e => e.category.toLowerCase().includes(catFilter));
      if(dateFilter) filtered = filtered.filter(e => e.date === dateFilter);

      filtered.sort((a,b) => new Date(b.date) - new Date(a.date));

      filtered.forEach(exp => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class='border p-2'>${exp.title}</td>
          <td class='border p-2'>${exp.amount.toFixed(2)}</td>
          <td class='border p-2'>${exp.category}</td>
          <td class='border p-2'>${exp.date}</td>
          <td class='border p-2'>${exp.notes || 'None'}</td>
          <td class='border p-2'>
            <button onclick="editExpense(${exp.id})" class="bg-yellow-400 text-white px-2 py-1 rounded hover:bg-yellow-500">Edit</button>
            <button onclick="deleteExpense(${exp.id})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Delete</button>
          </td>`;
        tbody.appendChild(row);
      });
    }

    function deleteExpense(id){
      expenses = expenses.filter(e => e.id !== id);
      saveExpenses();
      displayExpenses();
      displaySummary();
    }

    function editExpense(id){
      const exp = expenses.find(e => e.id === id);
      document.getElementById('title').value = exp.title;
      document.getElementById('amount').value = exp.amount;
      document.getElementById('category').value = exp.category;
      document.getElementById('date').value = exp.date;
      document.getElementById('notes').value = exp.notes;
      deleteExpense(id);
    }

    function displaySummary(){
      const summary = {};
      let total = 0;
      expenses.forEach(e => {
        total += e.amount;
        summary[e.category] = (summary[e.category] || 0) + e.amount;
      });
      const summaryDiv = document.getElementById('summary');
      summaryDiv.innerHTML = `Total Spent: $${total.toFixed(2)}<br>`;
      for (const [cat, amt] of Object.entries(summary)) {
        summaryDiv.innerHTML += `${cat}: $${amt.toFixed(2)}<br>`;
      }
      drawChart(summary);
    }

    function drawChart(summary){
      const ctx = document.getElementById('expenseChart').getContext('2d');
      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(summary),
          datasets: [{
            data: Object.values(summary),
            backgroundColor: Object.keys(summary).map((_,i)=>`hsl(${i*60},70%,60%)`)
          }]
        },
        options: {responsive:true, plugins:{legend:{position:'bottom'}}}
      });
    }
    loadExpenses();
    displayExpenses();
    displaySummary();
  </script>
</body>
</html>
